<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!--  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">-->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="msapplication-tap-highlight" content="no">
    <style>
    html, body {
      padding: 0;
      margin: 0;
	  height:100%;
	  width:100%;
	  
    }
      @font-face {
    font-family: 'HNUL'; /*a name to be used later*/
    src: url('HNUL.otf'); /*URL to font*/
}
          a:link {
    color: #000;
    text-decoration: none;
}

/* visited link */
a:visited {
    color: #000;
        text-decoration: none;

}

/* mouse over link */
a:hover {
    color: #000;
        text-decoration: none;

}

/* selected link */
a:active {
    color: #000;
        text-decoration: none;

}
 
    body {
      background-color: #ffffff;
      font: normal 10pt/13pt HelveticaNeue, SegoeWP, SegoeUI, Roboto, Sans-serif;
      -webkit-font-smoothing: subpixel-antialiased;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    article {
      padding: 40px 0;
    }
    nav {
        display: hidden;
      height: 65px;
      box-sizing: border-box;
      text-align: center;
      transition: opacity .5s ease-in;
      padding: 0 15px;
      background-color: #ffffff;
      border-bottom: solid 1px #a7a7aa;
      padding: 1px 0;
    }
    nav > h1 {
      text-align: center;
      font: normal 14pt/17pt HelveticaNeue, SegoeWP, SegoeUI, Roboto, Sans-serif;
    }
#menu {
    margin: 0;
    padding: 0;
    text-align: center;
    font-family: HNUL;
    font-size:25px;
}

#menu li {
    display: block;
    float: left;
    margin: 0;
    width: 25%;
    padding: 10px;
    box-sizing: border-box;
    font-family: HNUL;
   font-size:25px;
}
      #menu2 {
    margin: 0;
    padding: 0;
          text-align: center;
          font-family: HNUL;
   font-size:25px;
}
#italic{
  
background: url('images/italic.png');
background-size: 100%;
    width:40px;

    height:40px;
}
#strike{
  
background: url('images/strike.png');
background-size: 100%;
    width:40px;

    height:40px;
}
 #underline{
  
background: url('images/underline.png');
background-size: 100%;
    width:40px;

    height:40px;
}
#menu2 li {
    display: block;
    float: right;
    margin: 0;
    width: 33%;
    padding: 10px;
    box-sizing: border-box;
    font-family: HNUL;
   font-size:25px;
}
            #control-menu {
    margin: 0;
    padding: 0;
          text-align: center;
          font-family: HNUL;
   font-size:25px;
}

#control-menu li {
    display: block;
    float: left;
    margin: 0;
    width: 25%;
    padding: 10px;
    box-sizing: border-box;
    font-family: HNUL;
   font-size:25px;

}

          #menu3 {
    margin: 0;
    padding: 0;
text-align: center;
              font-family: HNUL;
              font-size:30px;
}


#menu3 li {
    display: block;
    float: left;
    margin: 0;
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    font-family: HNUL;
   font-size:25px;
}
    h2 {
      font: normal 14pt/17pt HelveticaNeue, SegoeWP, SegoeUI, Roboto, Sans-serif;
      color: #4d4d4d;
      margin: 0 0 20px 15px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
      #c{
      width: 100%;
      }
  </style>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js"></script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script> 
    <script src="cordova.js"></script>
        <script type="text/javascript" charset="utf-8">

    // Call onDeviceReady when PhoneGap is loaded.
    //
    // At this point, the document has loaded but phonegap-1.0.0.js has not.
    // When PhoneGap is loaded and talking with the native device,
    // it will call the event `deviceready`.
    // 
    document.addEventListener("deviceready", onDeviceReady, false);

    // PhoneGap is loaded and it is now safe to make calls PhoneGap methods
    //
    function onDeviceReady() {
        // Now safe to use the PhoneGap API
    }

    </script>
    <script>

    $(document).ready(function() {
        
        
    $('#c').click(function() {
    $(this).addClass('selected').siblings().removeClass('selected')
    });

    $("#strike").click(function() {
        var obj = canvas.getActiveObject();
    

                        
                    var style = { };
    style['textDecoration'] = 'line-through';
    obj.setSelectionStyles(style);
                
        canvas.renderAll();
    console.log(obj.getSelectedText());
        
});
        $("#italic").click(function() {
 
        var obj = canvas.getActiveObject();
    
//obj.setFontFamily('Verdana');
                        
                    var style = { };
    style['fontWeight'] = 'italic';
    obj.setSelectionStyles(style);
                
        canvas.renderAll();
    console.log(obj.getSelectedText());
        
});
                $("#underline").click(function() {
        
//        var obj = canvas.getActiveObject();
//    
////obj.setFontFamily('Verdana');
//                        
//                    var style = { };
//    style['textDecoration'] = 'underline';
//    obj.setSelectionStyles(style);
//                
//        canvas.renderAll();
//    console.log(obj.getSelectedText());
window.plugin.email.isServiceAvailable(
    function (isAvailable) {
alert(dataURL)
window.plugin.email.open({
    to:      ['info@appplant.de'],
    subject: 'Congratulations',
    body:    '<img src="'+dataURL+'" width="720" height="540">',
    isHtml:  true
});
        // alert('Service is not available') unless isAvailable;
    }
);   
});
        });
    </script>
  <title>ChUI 3.0</title>
  
</head>
<body>
  <nav>
    <h1>Terribly Tiny Tales</h1>
  </nav>
  <article id='main'>
    <section>
            <ul id="menu">
        <li><a href="#">write</a></li>
        <li><a href="#"></a></li>
            <li><a href="#"></a></li>
                <li><a href="drafts.html">drafts</a></li>
    </ul>
	<br /><br /><br/>
<canvas style="display:block; width:100%; height:540px; left:0px; right:0px; position:fixed;" id="c"></canvas><br />
         <ul id="control-menu">
<li><input type="button" class="pButtons" id="italic" /></li> 
      <li><input type="button" class="pButtons" id="strike" /></li>
        <li><input type="button" class="pButtons" id="underline" /></li>
		 <li><input style="text-align: center; font-family:HNUL; font-size:25px; border:0px solid; height:40px; width:40px; outline:none;" type="text" id="counter" disabled/></li>
    </ul>  
<!--
        <p style="display:inline;"><input type="button" class="pButtons" id="italic" /></p>
        <p style="display:inline;"><input type="button" class="pButtons" id="strike" /></p>
        <p style="display:inline;"><input type="button" class="pButtons" id="underline" /></p>
        <p style="display:inline;"><input type="text" id="counter" /></p>
        
-->
        <br />
           <ul id="menu2">
        <li><a onclick="delete1();">delete</a></li>
         <li><a href="javascript:savedraft();">save</a></li>
        <li><a href="mailto:someone@example.com?Subject=Hello%20again">submit</a></li>
    </ul>  
        <ul id="menu3">
        <li>
        <a href="needhelp.html">need help?</a></li>
            
        </ul>
    </section>
  </article>
</body>
<script>
var canvas = new fabric.Canvas('c');

// browser viewport size
	var w = window.innerWidth;
	var h = window.innerHeight;

	// stage dimensions
	var ow = 720; // your stage width
	var oh = 540; // your stage height
    	// keep aspect ratio
	    var scale = Math.min(w / ow, h / oh);

	   	// adjust canvas size
    
//
//canvas.setWidth(window.innerWidth);
//canvas.setHeight(300);    

canvas.setWidth(ow * scale);
canvas.setHeight(oh * scale);    


var width = canvas.getWidth();
var heigth= canvas.getHeight();    
var author= window.localStorage.getItem("name");
var iText1 = new fabric.IText('Enter Text',{minScaleLimit:1,fontSize: 30,fill:'white',fontFamily:'HNUL',lockScalingX:true,lockScalingY:true,lockRotation:true});
var by = new fabric.Text('by '+author,{left:width-100,top:heigth-45,fontSize:15,fill:'white',fontFamily:'HNUL',lockMovementX: true,lockMovementY: true,lockScalingX:true,lockScalingY:true,lockRotation:true});
var ttt = new fabric.Text('terribly tiny tales',{left:width-250,top:heigth-50,fontSize:18,fill:'white',fontFamily:'HNUL',useNative: true,lockMovementX: true,lockMovementY: true,lockScalingX:true,lockScalingY:true,lockRotation:true});
var hash=new fabric.IText('#smile',{right:width,top:heigth-45,fontSize:18,fill:'white',fontFamily:'HNUL',lockMovementX: true,lockMovementY: true,lockScalingX:true,lockScalingY:true,lockRotation:true});
var number=new fabric.IText('#000',{left:width-50,fontSize:18,fill:'white',fontFamily:'HNUL',lockMovementX: true,lockMovementY: true,lockScalingX:true,lockScalingY:true,lockRotation:true});
    
    
// canvas.setActiveObject(canvas.item(0));
//canvas.setActiveObject(iText1);


canvas.centerObject(iText1);
canvas.centerObjectH(ttt);
canvas.calcOffset();
canvas.setBackgroundColor('black');
canvas.add(iText1);
canvas.add(by);
canvas.add(ttt);
canvas.add(hash);
canvas.add(number);
canvas.renderAll.bind(canvas);
    canvas.renderAll();

document.getElementById('counter').value=iText1.text.length;
iText1.on('text:changed', function(e) {
document.getElementById('counter').value=iText1.text.length;

});
    var cHeight = canvas.getHeight();
    var cWidth = canvas.getWidth();

    var n1 = 720/cWidth;
    var n2 = 540/cHeight;
    
//alert(n2);

var dataURL = canvas.toDataURL({
  format: 'png',
  multiplier: n1
});
function delete1()
{
	var r=confirm("Are you sure you want to delete this tale/draft?");
	if(r==true)
	iText1.text='Enter Text';
	else console.log(10);
}
function savedraft() {
		
		var currentdate = new Date();
		var datetime = currentdate.getDay() + "."+currentdate.getMonth() 
						+ "." + currentdate.getFullYear() + " - " 
							+ currentdate.getHours() + "." 
						+ currentdate.getMinutes() + "." + currentdate.getSeconds(); 
		var b = localStorage.getItem("id");
		var z=parseInt(1);
		if(b)
		{
		var a = parseInt(localStorage.getItem("id"));
		alert(a);
		
		window.localStorage.setItem(a+"-diText1", iText1.text);
		window.localStorage.setItem(a+"-dhash", hash.text); 
		window.localStorage.setItem(a+"-dnumber", number.text);
		window.localStorage.setItem(a+"-ddate", datetime);
		window.localStorage.setItem("id",a + z);	
		}
		else
		{
		localStorage.setItem("id",0);
		a = parseInt(localStorage.getItem("id"));
		alert(a);
		window.localStorage.setItem(a+"-diText1", iText1.text);
		window.localStorage.setItem(a+"-dhash", hash.text); 
		window.localStorage.setItem(a+"-dnumber", number.text);
		window.localStorage.setItem(a+"-ddate", datetime);
		window.localStorage.setItem("id",a + z);	
		}
		
	 
}
    canvas.setActiveObject(iText1);

    document.write("<img src="+dataURL+" width='720' height='540'>");
    


</script>
</html>
